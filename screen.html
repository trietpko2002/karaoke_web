<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Karaoke Screen</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
html, body { margin:0; height:100%; background:#000; overflow:hidden; color:#fff; font-family:sans-serif; }
#player, #bg { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; }
#info { position:absolute; bottom:20px; left:20px; background:rgba(0,0,0,0.6); padding:10px 20px; border-radius:10px; font-size:20px; display:none; }
#count { position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.1); padding:10px 20px; border-radius:10px; font-size:18px; }
.fade { animation: fadeInOut 1s ease; }
@keyframes fadeInOut {
  from { opacity:0; transform:translateY(20px); }
  to { opacity:1; transform:translateY(0); }
}
</style>
</head>
<body>
<div id="bg"></div>
<iframe id="player" allow="autoplay" frameborder="0"></iframe>
<div id="info"></div>
<div id="count">ƒê√£ h√°t: 0 b√†i</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, onValue, set, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBFZ-3gJ9Gyj8lfmA1yN1l4H0x4P3hZhAE",
  authDomain: "karaoke-remote.firebaseapp.com",
  databaseURL: "https://karaoke-remote-default-rtdb.firebaseio.com",
  projectId: "karaoke-remote",
  storageBucket: "karaoke-remote.appspot.com",
  messagingSenderId: "1044492205920",
  appId: "1:1044492205920:web:karaokescreen"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const player = document.getElementById("player");
const info = document.getElementById("info");
const countEl = document.getElementById("count");
let count = 0;

let roomId = prompt("Nh·∫≠p Room ID:");
if (!roomId) roomId = "default";

const songRef = ref(db, "rooms/"+roomId+"/song");
const resetRef = ref(db, "rooms/"+roomId+"/reset");
const resetScreenRef = ref(db, "rooms/"+roomId+"/resetScreen");

// L·∫Øng nghe reset s·ªë b√†i
onValue(resetRef, snap=>{
  if (snap.val() === true){
    count = 0;
    countEl.textContent = "ƒê√£ h√°t: 0 b√†i";
    set(resetRef, false);
  }
});

// L·∫Øng nghe reset screen
onValue(resetScreenRef, snap=>{
  if (snap.val() === true){
    location.reload();
  }
});

// L·∫Øng nghe b√†i m·ªõi
onValue(songRef, snap=>{
  const song = snap.val();
  if (!song) return;

  fadeVideo(song.url);
  showInfo(song.title);
  count++;
  countEl.textContent = "ƒê√£ h√°t: " + count + " b√†i";
});

function fadeVideo(url){
  player.classList.remove("fade");
  void player.offsetWidth;
  player.src = "https://www.youtube.com/embed/" + url + "?autoplay=1&controls=0";
  player.classList.add("fade");
}

function showInfo(title){
  info.textContent = "üéµ " + title;
  info.style.display = "block";
  info.classList.add("fade");
  setTimeout(()=>{ info.style.display="none"; },5000);
}
</script>
</body>
</html>
