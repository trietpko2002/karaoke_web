<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Karaoke Screen</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html,body {margin:0;height:100%;background:#000;overflow:hidden;color:#fff;font-family:sans-serif;text-align:center;}
#bg {position:absolute;top:0;left:0;right:0;bottom:0;background:url('https://picsum.photos/1920/1080?blur') center/cover;transition:opacity 1s ease;}
#videoFrame {position:absolute;top:0;left:0;width:100%;height:100%;border:none;display:none;transition:opacity 1s ease;}
#overlay {position:absolute;bottom:20px;width:100%;text-align:center;font-size:2em;}
#songName {display:inline-block;white-space:nowrap;overflow:hidden;animation:marquee 15s linear infinite;}
@keyframes marquee {0%{transform:translateX(100%);}100%{transform:translateX(-100%);}}
#stats {position:absolute;top:10px;left:10px;font-size:1.2em;background:rgba(0,0,0,0.5);padding:8px 12px;border-radius:8px;}
.fade {opacity:0;pointer-events:none;}
</style>
</head>
<body>
<div id="bg"></div>
<iframe id="videoFrame"></iframe>
<div id="overlay"><span id="songName"></span></div>
<div id="stats">
  Room: <span id="room"></span><br>
  Đã hát: <span id="count">0</span> bài
</div>
<script>
const room = prompt("Nhập Room ID:");
document.getElementById("room").innerText = room;
let count = 0;
const video = document.getElementById("videoFrame");
const bg = document.getElementById("bg");
const songName = document.getElementById("songName");

function fadeOut(el){el.classList.add('fade');}
function fadeIn(el){el.classList.remove('fade');}

window.addEventListener('storage', e=>{
  if(e.key === 'karaoke_action_'+room){
    const data = JSON.parse(e.newValue || "{}");
    if(data.type==="play"){
      fadeOut(bg);
      songName.textContent = "Đang phát: "+data.title;
      video.src = `https://www.youtube.com/embed/${data.id}?autoplay=1&enablejsapi=1`;
      video.style.display="block"; fadeIn(video);
      count++; document.getElementById("count").innerText=count;
    }
    else if(data.type==="stop"){
      fadeOut(video);
      setTimeout(()=>{
        video.src=""; video.style.display="none";
        songName.textContent="";
        fadeIn(bg);
      },800);
    }
    else if(data.type==="reset"){
      count=0;
      document.getElementById("count").innerText=0;
    }
  }
});
</script>
</body>
</html>
