<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Karaoke Remote</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body { margin:0; font-family:sans-serif; background:#1a1a1a; color:#fff; display:flex; height:100vh; justify-content:center; align-items:center; }
.container { width:90%; max-width:800px; background:#222; padding:20px; border-radius:10px; box-shadow:0 0 10px #000; }
h2 { margin-bottom:15px; color:#ff3b3f; border-bottom:2px solid #ff3b3f; padding-bottom:5px; text-align:center; }
.search-bar { display:flex; gap:5px; margin-bottom:10px; }
input { flex:1; padding:10px; border:none; border-radius:5px; font-size:16px; outline:none; }
button { padding:10px 12px; border:none; background:#ff3b3f; color:white; border-radius:5px; cursor:pointer; transition:0.2s; }
button:hover { background:#e52a2f; }
.switch { display:flex; align-items:center; margin-bottom:10px; gap:6px; }
.item { display:flex; align-items:center; margin-top:10px; background:#333; padding:8px; border-radius:6px; cursor:pointer; transition:0.2s; }
.item:hover { background:#444; }
.item img { width:100px; height:70px; object-fit:cover; margin-right:12px; border-radius:6px; }
.title { font-size:0.95em; line-height:1.2em; flex:1; color:#fff; }
#status { margin-top:10px; color:#aaa; font-size:0.9em; text-align:center; }
</style>
</head>
<body>
<div class="container">
  <h2>üé§ Karaoke Gia ƒê√¨nh</h2>

  <div class="search-bar">
    <input id="q" placeholder="Nh·∫≠p t√™n b√†i h√°t..." />
    <button onclick="search()">T√¨m</button>
    <button id="stopBtn">‚èπÔ∏è D·ª´ng</button>
  </div>

  <div class="switch">
    <input type="checkbox" id="karaokeOnly" checked />
    <label for="karaokeOnly">Ch·ªâ Karaoke</label>
  </div>

  <div id="status"></div>
  <div id="list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = { 
  apiKey: "AIzaSyC1JW_dg-YChaizarbS-7UUN3njFomMPvI",
  authDomain: "karaokeweb-d414b.firebaseapp.com",
  databaseURL: "https://karaokeweb-d414b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "karaokeweb-d414b",
  storageBucket: "karaokeweb-d414b.firebasestorage.app",
  messagingSenderId: "183555717781",
  appId: "1:183555717781:web:d3920b342c5d27e107f99c",
  measurementId: "G-VZ228HB7GF"
};

const API_KEY = "AIzaSyALYcXF9pG01RbeCx6DaZADNwNro2NKq4I";
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const commandRef = ref(db,"command");

const listEl = document.getElementById("list");
const statusEl = document.getElementById("status");
const stopBtn = document.getElementById("stopBtn");
let muteState = false;

// üîç T√¨m ki·∫øm b√†i h√°t
async function search(){
  const q = document.getElementById("q").value.trim();
  const karaokeOnly = document.getElementById("karaokeOnly").checked;
  if(!q) return alert("Nh·∫≠p t·ª´ kh√≥a!");
  listEl.innerHTML = "";
  statusEl.textContent="üîç ƒêang t√¨m...";
  try{
    const res = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=12&q=${encodeURIComponent(q + (karaokeOnly?" karaoke":""))}&videoEmbeddable=true&key=${API_KEY}`);
    const data = await res.json();
    statusEl.textContent="";
    if(!data.items || data.items.length===0){ statusEl.textContent="‚ùå Kh√¥ng t√¨m th·∫•y"; return; }
    data.items.forEach(v=>{
      if(!v.id?.videoId) return;
      const el=document.createElement("div");
      el.className="item";
      el.innerHTML=`<img src="${v.snippet.thumbnails.medium.url}"><div class="title">${v.snippet.title}</div>`;
      el.onclick=()=> playNow(v.id.videoId, v.snippet.title);
      listEl.appendChild(el);
    });
  }catch(e){ console.error(e); statusEl.textContent="‚ö†Ô∏è L·ªói t√¨m ki·∫øm"; }
}

// ‚ñ∂Ô∏è Ph√°t ngay b√†i h√°t ƒë∆∞·ª£c ch·ªçn
function playNow(id, title){
  set(commandRef,{id,title,play:true,mute:muteState});
  statusEl.textContent=`üéµ ƒêang ph√°t: ${title}`;
}

// ‚èπÔ∏è D·ª´ng b√†i, chuy·ªÉn v·ªÅ intro/slide
stopBtn.onclick = ()=>{
  set(commandRef,{id:"",title:"Intro / Slide",play:false,mute:muteState});
  statusEl.textContent="‚èπÔ∏è ƒê√£ d·ª´ng b√†i h√°t";
};

// G√µ Enter ƒë·ªÉ t√¨m nhanh
document.getElementById("q").addEventListener("keydown", e=>{
  if(e.key==="Enter") search();
});

</script>
</body>
</html>